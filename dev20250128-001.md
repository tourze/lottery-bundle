# H5抽奖活动开发任务

## 工作内容概述

### 需求背景

为lottery-bundle抽奖模块创建H5抽奖活动页面，让用户可以通过Web浏览器参与抽奖活动。系统需要支持通过URL参数访问不同的抽奖活动，提供友好的用户界面和流畅的抽奖体验。

### 核心功能

1. **活动展示功能**
   - 支持通过URL参数（activity_id）访问指定抽奖活动
   - 展示活动头图、标题、规则说明
   - 显示活动开始/结束时间
   - 展示奖品列表和中奖概率

2. **抽奖核心功能**
   - 用户登录验证
   - 显示用户可用抽奖次数
   - 抽奖动画效果
   - 中奖结果展示
   - 抽奖历史记录查看

3. **奖品处理功能**
   - 虚拟奖品自动发放
   - 实物奖品收货地址填写
   - 中奖记录管理

4. **响应式设计**
   - 移动端友好的界面设计
   - 适配不同屏幕尺寸
   - 流畅的动画效果

### 技术范围

- **后端**: PHP 8.1+, Symfony 6.4+
- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **接口**: 复用现有JSON-RPC接口
- **样式框架**: 自定义CSS（响应式设计）

## 任务拆分与进度计划

| 任务阶段 | 具体任务项    | 优先级 | 预估耗时 | 进度状态（✅/⏳/🔄） | 责任人   |
| --- | ---- | ----- | --- | ---- | ---- |
| 需求分析 | 1. 分析lottery-bundle现有架构和接口        | P0  | 1h   | ✅                   | AI 工具 |
|           | 2. 确定H5页面功能和交互流程              | P0  | 1h   | ✅                   | AI 工具 |
| 架构设计 | 1. 设计H5Controller路由和方法            | P0  | 1h   | ⏳                   | AI 工具 |
|           | 2. 设计前端页面结构和组件划分              | P1  | 1h   | ⏳                   | AI 工具 |
| 编码实现 | 1. 实现H5LotteryController控制器        | P0  | 2h   | ⏳                   | AI 工具 |
|           | 2. 创建抽奖页面HTML模板                 | P0  | 2h   | ⏳                   | AI 工具 |
|           | 3. 实现CSS样式（响应式设计）              | P0  | 3h   | ⏳                   | AI 工具 |
|           | 4. 实现JavaScript抽奖逻辑和动画          | P0  | 3h   | ⏳                   | AI 工具 |
|           | 5. 实现收货地址填写功能                  | P1  | 2h   | ⏳                   | AI 工具 |
| 测试验收 | 1. 功能测试（不同活动、不同奖品类型）        | P0  | 2h   | ⏳                   | AI 工具 |
|           | 2. 响应式测试（移动端、平板、桌面端）        | P1  | 1h   | ⏳                   | AI 工具 |

## 验收条件清单

### 功能验收

- ✅ 可以通过URL参数访问指定抽奖活动
- ✅ 正确展示活动信息和奖品列表
- ✅ 用户可以正常参与抽奖并查看结果
- ✅ 实物奖品可以填写收货地址
- ✅ 抽奖次数限制正确生效
- ✅ 抽奖动画效果流畅自然

### 技术验收

- ✅ 代码符合PSR标准和项目规范
- ✅ 响应式设计适配移动端
- ✅ 接口调用正确处理异常情况
- ✅ 页面加载性能良好

### 兼容性验收

- ✅ 支持主流移动浏览器（Safari、Chrome、微信内置浏览器）
- ✅ 支持不同屏幕尺寸（320px-1920px）

## 特殊备注说明

- H5页面需要考虑移动端用户体验，特别是抽奖动画的流畅性
- 需要处理网络异常情况，提供友好的错误提示
- 收货地址填写页面需要表单验证
- 考虑添加分享功能以增加活动传播

## 技术实现要点

### URL参数设计

- 访问路径：`/h5/lottery?activity_id={活动ID}`
- 支持活动不存在或已结束的处理

### 页面结构设计

1. 活动头部（头图、标题、剩余时间）
2. 奖品展示区域
3. 抽奖操作区域（转盘/九宫格等）
4. 用户抽奖记录
5. 活动规则说明

### 接口调用流程

1. `GetLotteryDetail` - 获取活动详情
2. `GetLotteryPrizeList` - 获取奖品列表  
3. `GetUserValidLotteryChanceCounts` - 获取可用次数
4. `JoinLottery` - 执行抽奖
5. `SaveOrUpdateLotteryConsignee` - 保存收货地址
